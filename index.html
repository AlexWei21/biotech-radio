<script type="module">
    // Import the library directly from a browser-friendly CDN
    import Vapi from 'https://esm.sh/@vapi-ai/web';

    // --- CONFIGURATION ---
    const PUBLIC_KEY = "59b67b86-28d8-497d-9d84-99b5683389fc"; 
    const ASSISTANT_ID = "23e3cfd4-e35e-4c51-8d0a-4499c5b9c78b"; 
    // Initialize Vapi
    const vapi = new Vapi(PUBLIC_KEY);

    // --- BUTTON LOGIC ---
    // We attach this to 'window' so your HTML button can find it
    window.toggleVapi = function() {
        const btn = document.getElementById("vapi-btn");
        
        // Check if we are already in a call
        if (vapi.started) {
            vapi.stop();
            btn.innerText = "ðŸŽ™ï¸ Tap to Listen";
            btn.style.backgroundColor = "#eef2ff"; // Reset color
        } else {
            btn.innerText = "Connecting...";
            vapi.start(ASSISTANT_ID)
                .then(() => {
                    btn.innerText = "ðŸ”´ Stop";
                    btn.style.backgroundColor = "#fee2e2"; // Red for active
                })
                .catch((err) => {
                    console.error("Failed to connect:", err);
                    btn.innerText = "Error (See Console)";
                });
        }
    };

    // --- EVENT LISTENERS (Optional: For Debugging) ---
    vapi.on('call-start', () => console.log('Call has started!'));
    vapi.on('call-end', () => {
        console.log('Call ended');
        document.getElementById("vapi-btn").innerText = "ðŸŽ™ï¸ Tap to Listen";
    });
    vapi.on('error', (e) => console.error('Vapi Error:', e));

</script>